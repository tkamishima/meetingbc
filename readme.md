学会のハイブリッド配信
=================

* Author : [Toshihiro Kamishima](http://www.kamishima.net/)
* Copyright : Copyright (c) 2023 Toshihiro Kamishima all rights reserved.

配信環境整備で注意すべき点
====================

ここに示した事項以外で注意すべき点については ★ 印を付ける．

HDMI端子
----------

講演者のPCの映像を，HDMI端子から出して，他のPCに取り込む場合に，HDCP (High-Bandwidth Digital Content Protection) という著作権保護機構が問題になる．Macや，一部のWindowsでは，画面で再生した映画などが録画されないようにこのHDCPが働く．そのため，HDMIキャプチャーを使って運営者PCで，講演者PCの画面を取り込めない．

USB音声入力
-------------

UAC (USB Audio Class) を通じて，USBマイクや，USBオーディオインタフェースをWindowsで音声を取り込むときに，専用のドライバが必要になる場合がある．UACのバージョン1なら使えるとの情報もあるが，経験上はドライバが必要になるWindowsPCが多く，音声を取り込めない事態がよくある．

会場の音響設備
---------------

会場のマイク音声が，全てミックスされた信号が取り出せない場合は，会場用と配信用に二つのマイクに向かって講演する必要が生じる．

遠隔講演者の音声を会場で出力するために，PCの音声出力を，会場のスピーカー出力できる必要になる．これができない場合は，小型のアンプ付きスピーカーを使うことになるが，大きな会場では無理．

ケーブルの長さ
--------------

ケーブルの長さの制約のため，会場で機器間の接続ができないというトラブル生じる．

### 映像ケーブル

* HDMIは規格上は長さ制限はないが，パッシブだと10mぐらいでも厳しい．
* USBで伝送するとき，フルHDだとUSB3.2Gen1以上必要らしく，Type-Cだと2mが規格の上限．それ以上はアクティブケーブルを伝送に使う必要．

### 音声ケーブル

* 一番長く伝送するならXLR/キャノンケーブルであれば，規格はないが50mとかでも大丈夫らしいです．
* USBケーブルはUSB 2.0で伝送できるので5mが規格上限
* 6.3mm標準ジャック／3.5mmミニジャックのケーブルだと5mあたりにした方が無難

講演者PCの音声
----------------

講演者が，自身のPCで音のあるデモやビデオ再生を行うときは，そのPCの音を配信用のPCに入力できる必要がある．

処理すべき信号
===========

※ **太字**のものは必須で，その他のものは場合によっては必要になる．

* 遠隔の講演者
	* 映像：**発表資料**
	* 映像：発表者自身の映像
	* 音声：**発表者の発話**
	* 音声：発表者PC音声（PC上のデモや，再生したビデオの音声）
* 会場の講演者
	* 映像：**発表資料**
	* 映像：講演者自身の映像
	* 音声：**発表者の発話**
	* 音声：発表者PC音声（PC上のデモや，再生したビデオの音声）
* 会場その他
	* 映像：司会者資料（セッションの説明など）
	* 映像：休憩時間映像（セッションの内容や時刻を放映）
	* 音声：**司会者の発話**
	* 音声：質問者の発話
* 会場への映像・音声出力
	* 映像：**会場映像**（会場発表者の発表資料など）
	* 映像：**配信映像**（遠隔発表者の発表資料など）
	* 音声：**会場音声**（会場発表者・司会者・質問者音声など）
	* 音声：**配信音声**（配信されている遠隔発表者発話・遠隔質問者発話，遠隔発表者PC音声など）

遠隔の講演者・一般参加者
==================

* 遠隔からの講演は，物理会場のないオンラインのみの講演を行うのと差はない．そのため，遠隔講演者が自身で自身の配信環境を整備するため，運営者側はオンライン会議の環境を提供する以外に，特に準備すべき事柄はない．
* 発表者と聴講者の権限に差があるWebinarなどの場合には，セッションの開始前に発表者権限を与えておくこと．権限が与えられていない場合，発話や画面共有ができない．
* 発表者のスライドなどは画面共有で行う．★共有できない場合は，運者が共有を許可していないか，前の講演者の画面共有を修了しているかを確認．
* 発表者PCの音声を配信する場合は，★Zoomでは画面共有のときのオプションにPCの音声も共有するかの項目があるかを確認．
* 遠隔の質問は，全員が発言できる会議形式のときは音声で，発表者のみ発言できるWebinarの場合は，オンライン会議の質問機能や，sli.doやSlackなどの外部サービスを併用する．

物理会場の講演者・運営者・質問者
========================

物理会場からの配信では，(1) 発表者・運営者PCを共有する場合と，(2)発表者PCと運営者PCを分離する場合の2通りがある．(2)の場合は映像や音声をどのように配信するかにさらに分けられる

* (1) 発表者PCと運営者PCを共有する
	* 配信PC＝発表者PC，発表者音声＝発表者PC，司会・質問者音声＝発表者PC
* (2A) 発表者PCと運営者PCを分離し，発表者PCから講演資料を配信
	* 配信PC＝発表者PC，発表者音声＝発表者PC，司会・質問者音声＝運営者PC／発表者PC
* (2B) 発表者PCと運営者PCを分離し，運営者PCから講演資料を配信
	* 配信PC＝運営者PC，発表者音声＝運営者PC，司会・質問者音声＝運営者PC

各配信方法の利点・欠点
-----------------------

* (1) 発表者PCと運営者PCを共有する
	* ○ 必要になる機材が少なく，準備するPCが1台で済む
	* ○ 設定が最も容易
	* × 発表者が自身のPCを講演に利用できない
	* × 共用PCで発表資料を表示する必要があり，発表資料のフォーマットに制限
	* × 発表者，運営者，質問者のマイクを共有する場合は，運営者も質問者も発表者の位置まで移動する必要がある
	* × 発表者，運営者，質問者の音声が同じアカウントから配信される
	* × プレゼンソフトやデモによるクラッシュが配信環境に影響する
	* × 発表者PCが，講演と配信の同時負荷に耐えられない場合がある
* (2A) 発表者PCと運営者PCを分離し，発表者PCから講演資料を配信
	* ○ 発表者が自身のPCを利用できる
	* × 発表者の交代時に設定が多い
	* × 映像と音声が異なるアカウントから配信される
	* × 発表者がそれぞれオンライン会議システムに接続可能である必要
	* × 発表者PCが，講演と配信の同時負荷に耐えられない場合がある
* (2B) 発表者PCと運営者PCを分離し，運営者PCから講演資料を配信
	* ○ 発表者が自身のPCを利用できる
	* ○ 発表者PC設定事項が少ない
	* ○ OBSを使った複雑な画面構成や配信が可能になる
	* × 発表者の講演資料の映像がアナログになる
	* × 必要な機材が多い

(1) 発表者PCと運営者PCを共有する
-----------------------------------

* **配信**
	* 発表者PCで，配信サービスにログイン
	* 発表者・運営者でアカウントを共有して，全ての映像・音声はこのアカウントから配信
* **発表資料**
	* 発表者PCの画面共有で配信
* 講演者自身の映像
	* 発表者PCの内蔵カメラ，もしくは発表者PCに接続したカメラで撮影し配信サービスへ
* **発表者の発話**
	* a) 発表者PCの内蔵マイク → 音が悪い，会場用と2本マイクになる
	* b) 発表者PCに接続したマイク → 会場用と2本マイクになる
	* c) 会場内音声の分岐を発表者PCに入力 → 会場の設備が整っていれば最良の選択
* 発表者PC音声（PC上のデモや，再生したビデオの音声）
	* 発表者PCの画面共有時にPC音声も共有する
* 司会者資料（セッションの説明など）
	* 発表者PCの画面共有で配信
* 休憩時間映像（セッションの内容や時刻を放映）
	* 発表者PCの画面共有で配信
* **司会者の発話**
	* 発表者の発話と同じ方法で配信
	* マイクを発表者と分けるときは，発表者の発話音声とミックスできるソフトか機器が必要
* 質問者の発話
	* 発表者の発話と同じ方法で配信
	* マイクを発表者と分けるときは，発表者の発話音声とミックスできるソフトか機器が必要
* **会場映像**（会場発表者の発表資料など）
	* 発表者PCの画面をプロジェクタで出力
* **配信映像**（遠隔発表者の発表資料など）
	* 遠隔講演者が共有した映像を発表者PCで表示し，その画面をプロジェクタで出力
* **会場音声**（会場発表者・司会者・質問者音声など）
	* 発表者の発話が a や b の場合は，別のマイクを準備して，会場の音響設備から出力
		* 発表者は二つのマイクに向かって発話することになる
	* 発表者の発話が c の場合は，すでに会場の音響設備から発話されている
* **配信音声**（配信されている遠隔発表者発話・遠隔質問者発話，遠隔発表者PC音声など）
	* 発表者PCの音声出力を，会場の音響設備から出力．

(2A) 発表者PCと運営者PCを分離し，発表者PCから講演資料を配信
-----------------------------------------------------------------

* **配信**
	* 講演資料は発表者PCから発表者のアカウントを通じて配信
	* 発表者の発話は発表者PCか運営者PCのいずれかから，それぞれのアカウントを通じて配信
* **発表資料**
	* 発表者PCの画面共有で配信
* 講演者自身の映像
	* 発表者PCの内蔵カメラ，もしくは発表者PCに接続したカメラで撮影し配信サービスへ
* **発表者の発話**
	* a) 発表者PCの内蔵マイク → 音が悪い，会場用と2本マイクになる
	* b) 発表者PCに接続したマイク → Windowsのドライバが問題になる，会場用と2本マイクになる
	* c) 運営者PCに接続したマイク → 会場用と2本マイクになる，発表者までのケーブル長に注意
	* d) 会場内音声の分岐を運営者PCに入力 → 会場の設備が整っていれば最良の選択
* 発表者PC音声
	* 発表者PCの画面共有時にPC音声も共有する
* 司会者資料
	* 運営者PCの画面共有で配信
* 休憩時間映像
	* 運営者PCの画面共有で配信
* **司会者の発話**
	* e) 運営者PCに接続したマイク → 会場用と2本マイクになる，ソフトかハードのミキサーが必要
	* f) 会場内音声の分岐を運営者PCに入力 → 会場の設備が整っていれば最良の選択
* 質問者の発話
	* 司会者の発話が e の場合 → 司会者とマイクを共用
	* 司会者の発話が f の場合 → 会場内のマイクから入力できる
* **会場映像**
	* 発表者PCの画面をプロジェクタで出力 → 配信映像を出力するときに映像ケーブルを繋ぎ替える必要
	* 運営者PCの画面をプロジェクタで出力 → 会議システムの画面を映すので遅延が出ることがある
* **配信映像**
	* 運営者PCの画面をプロジェクタで出力
* **会場音声**
	* 発表者の発話が a，b，または c の場合は，別のマイクを準備して，会場の音響設備から出力
		* 発表者は二つのマイクに向かって発話することになる
	* 発表者の発話が d の場合は，すでに会場の音響設備から発話されている
* **配信音声**
 	* 運営者PCの音声出力を，会場の音響設備から出力．

(2B) 発表者PCと運営者PCを分離し，運営者PCから講演資料を配信
-----------------------------------------------------------------

* **配信**
	* 運営者PCから運営者のアカウントを通じて配信
* **発表資料**
	* a) HDMIキャプチャで運営者PCに入力 → 全ての発表者PCのHDMIがHDCPがあっても出力可能である必要
	* b) HDMIをVGAなどアナログ変換して運営者PCに入力 → アナログ変換で映像が劣化
	* c) カメラでスクリーンを撮影して運営者PCに入力 → アナログ変換で映像が劣化，スクリーン前の発表者やレーザーポインタも配信できる
* 講演者自身の映像
	* カメラで撮影し，運営者PCに入力
* **発表者の発話**
	* d) 運営者PCに接続したマイク → 会場用と2本マイクになる，発表者までのケーブル長に注意
	* e) 会場内音声の分岐を運営者PCに入力 → 会場の設備が整っていれば最良の選択
* 発表者PC音声
	* 発表者PCの外部音声出力を運営者PCに入力
* 司会者資料
	* 運営者PCの画面を共有
* 休憩時間映像
	* 運営者PCの画面を共有  
* **司会者の発話**
	* f) 運営者PCに接続したマイク → 会場用と2本マイクになる，ソフトかハードのミキサーが必要
	* g) 会場内音声の分岐を運営者PCに入力 → 会場の設備が整っていれば最良の選択
* 質問者の発話
	* 司会者の発話が f の場合 → 司会者の発話と共有
	* 司会者の発話が g の場合 → 会場の設備が整っていれば最良の選択
* **会場映像**
	* 発表資料が a か b の場合 → 運営者PCの画面をプロジェクタに出力
	* 発表資料が c の場合 → 発表者PCの画面をプロジェクタに出力
* **配信映像**
	* 運営者PCの画面をプロジェクタで出力
* **会場音声**
	* 発表者の発話が a の場合 → 別のマイクを準備して，会場の音響設備から出力
		* 発表者は二つのマイクに向かって発話することになる
	* 発表者の発話が b の場合は，すでに会場の音響設備から発話されている
* **配信音声**
 	* 運営者PCの音声出力を，会場の音響設備から出力．

配信用機器
========

マイク
------

### 形式

* カラオケ形式のマイクはハンドマイクという
* 会議場にある細くて，先端に小さな丸い部分があるマイクはグースネックマイクという
* ピンマイクは，音響機器店ではラベリアマイクと呼ばれている
* 演台上に置く平らなマイクはバウンダリーマイクというが，軽いものは打鍵音を拾う

### アナログマイク

* ダイナミックマイクとコンデンサーマイクとがある
	* ダイナミックの方が小さな音を拾いにくい
	* 稼働部分が繊細なので，叩くのは厳禁
* コンデンサーマイクの方が感度がいいが，48Vとかのファンタム電源を供給できる必要がある．
* PCに信号を取り込むにはUSBオーディオインタフェースが必要になる
* ピンジャックより，キャノンコネクタののの方がケーブルを長く伸ばせる
* ステレオピンジャックのもので，プラグインパワーという電源供給規格に対応していないと使えないものもある

### USBマイク

* ダイナミックマイクとコンデンサーマイクとがある
* PCに直接取り込みが可能
* USB-C から電源を取らないコンデンサーマイクには別途電源が必要なものもある
* Windowsではドライバのインストールが必要な場合がある

### Bluetoothマイク

* 無線で使えるので，ヘッドセットやラベリアマイクで便利
* PCを換えるごとにペアリングが必要
* 充電が必要で，長い学会だと電池がなくなる
* 音は良くない

音声ケーブル
------------

### キャノンケーブル

* 3ピンでモノラルのケーブル
* ノイズに強く，長く伸ばせて，不意に抜けにくい
* 太い，重い，高価

### ピンジャック

* フォンジャックともいう
* 形状は同じでも，マイクレベルとラインレベルがあり，後者の方が1000倍ぐらい電圧レベルが高い
	* アナログのままなら，マイク→ラインは，ミキサーやプリアンプを，ライン→マイクはアッテネーターなどを使って変換
* ケーブルの長さは5mぐらい，無理しても10mぐらいでやめた方がいいと思う
* 入出力が一緒になった4極プラグは，信号の配置が違うものがあるので注意（OMTP や CTIA で検索）

音声の取り込み
--------------

### PCの音声入力

* ピンジャックで入力するものは，PCによってマイクレベルとラインレベルがあるので注意

### USBオーディオインターフェース

* アナログマイクを繋ぎ，DA変換をしてUSBへ出力
	* 電源容量の面でも有利だったりするので，USB-C のものの方がよい
* 少なくとも発表者と司会・質問者の二つのマイクは入力できるものを薦める
* コンデンサーマイクを使うときはファンタム電源を供給できるものを選ぶ
	* USB-Cではなく，USB-Aからの電源供給では電力不足でファンタム電源が供給できない
* PCが出力する音声とマイクをミキシングするループバックという機能が付いているものがある
	* PC内でソフト的にミックスするものや，OBSが使える状況なら，そっちの方が便利

映像の取り込み
--------------

### ビデオキャプチャーデバイス

* HDMI，VGA，SDI の映像をUSBを通じて取り込む機器
* USB Video Class (UVC) に対応していないものは止めた方がよい
	* 他の配信ソフトと連携できなかったりという制限が生じる
*  4K 対応だと，長時間は熱停止するものがあるので注意
* 変換の遅延時間が長いものは，発話とずれたりするので注意

### カメラ

* UVC に対応した出力のあるものか，HDMI 出力のあるものを選ぶ
* HDMI端子の出力は，カメラが付ける撮影状況などの情報を消せるものである必要
* 長時間使うと，冷却ファンのないものは熱停止するものがある
	* カメラ内部でへの時録画は止める
	* UVC 主力ではなく，HDMI 出力 + ビデオキャプチャーにする
	* 画像の出力を 4K/8K ではなく，HD 画質に留めておく
* 内部電池で時間が足りないときは，USBや外部電源を供給

ソフトウェア
------------

### OBSなど

* OBS (Open Broadcaster Software) は配信を行うソフトの代表
	* https://obsproject.com/
	* 同様の目的のソフトに XSplit Broadcaster，Ecamm Live，Streamlabs などがある
* 発表資料と講演者を同時に画面に表示したり，複数の音声をミキシングできたりと，凝った配信画面を作成できる
* 講演時間と休憩時間の切り替えなども容易にできる

### 仮想音声デバイス

* 物理デバイスに対応しない，ソフトウェア的なデバイス
* 会議配信が Zoom だと ZoomAudioDevice というので，配信される音声をOBSやソフトウェアミキサーに入力したり，Zoom で音声を配信したりできる

### ソフトウェアミキサー

* ソフトウェア的に音声信号をミキシングするソフト
* Zoom から取り込んだ音声と，接続したマイクの音声をミキシングしたりしても，ハウリングを起こさないようにするには必要
* Mac だと Loopback というソフトを薦める https://rogueamoeba.com/loopback/
